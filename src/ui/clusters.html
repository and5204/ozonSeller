<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Clusters</title>
</head>
<body>
<select id="place">
    <option value="">Select region</option>
    <option value="RUS">Russia</option>
    <option value="SNG">SNG</option>
</select>

<select id="clusters">
    <option value="">Select cluster</option>
</select>

<select id="warehouses">
    <option value="">Points To Ship Supplies</option>
</select>
<select id="products">
    <option value="">Select product</option>
</select>


<script>
/* =========================
   1. Load clusters by region
   ========================= */
async function loadClusters() {
    const place = document.getElementById("place").value;
    if (!place) return;

    const response = await fetch(`/api/clusters?place=${place}`);
    const data = await response.json();

    const clusterSelect = document.getElementById("clusters");
    const warehouseSelect = document.getElementById("warehouses");

    clusterSelect.innerHTML = '<option value="">Select cluster</option>';
    warehouseSelect.innerHTML = '<option value="">Points To Ship Supplies</option>';

    if (!data.clusters) return;

    data.clusters.forEach(cluster => {
        const option = document.createElement("option");
        option.value = cluster.name;
        option.text = cluster.name;
        clusterSelect.appendChild(option);
    });
}

/* =================================
   2. Load warehouses by cluster name
   ================================= */
async function loadWarehouses() {
    const clusterName = document.getElementById("clusters").value;
    if (!clusterName) return;

    const response = await fetch(
        `/api/warehouses?cluster_name=${encodeURIComponent(clusterName)}`
    );
    const data = await response.json();

    const warehouseSelect = document.getElementById("warehouses");
    warehouseSelect.innerHTML = '<option value="">Points To Ship Supplies</option>';

    if (!data.warehouses) return;

    data.warehouses.forEach(w => {
        const option = document.createElement("option");
        option.value = w.warehouse_id;
        option.text = `${w.name} (${w.warehouse_type})`;
        warehouseSelect.appendChild(option);
    });
}

/* =========================
   3. Load products
   ========================= */
async function loadProducts() {
    const response = await fetch("/api/products");
    const data = await response.json();

    const productSelect = document.getElementById("products");
    productSelect.innerHTML = '<option value="">Select product</option>';

    if (!data.products) return;

    data.products.forEach(p => {
        const option = document.createElement("option");
        option.value = p.product_id;
        option.text = `Offer: ${p.offer_id} | ID: ${p.product_id} | Qty: ${p.total}`;
        productSelect.appendChild(option);
    });
}

/* =========================
   4. Event bindings
   ========================= */
document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("place").addEventListener("change", loadClusters);
    document.getElementById("clusters").addEventListener("change", loadWarehouses);

    // load products ON PAGE LOAD
    loadProducts();
});
</script>




</body>
</html>
