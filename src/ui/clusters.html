<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Clusters</title>
</head>
<body>
<select id="place">
    <option value="">Select region</option>
    <option value="RUS">Russia</option>
    <option value="SNG">SNG</option>
</select>

<select id="clusters">
    <option value="">Select cluster</option>
</select>

<select id="warehouses">
    <option value="">Points To Ship Supplies</option>
</select>


<script>
/* =========================
   1. Load clusters by region
   ========================= */
async function loadClusters() {
    const placeSelect = document.getElementById("place");
    const place = placeSelect.value;

    if (!place) return;

    const response = await fetch(`/api/clusters?place=${place}`);
    const data = await response.json();

    const clusterSelect = document.getElementById("clusters");
    const warehouseSelect = document.getElementById("warehouses");

    clusterSelect.innerHTML = '<option value="">Select cluster</option>';
    warehouseSelect.innerHTML = '<option value="">Points To Ship Supplies</option>';

    if (!data.clusters) return;

    data.clusters.forEach(cluster => {
        const option = document.createElement("option");
        option.value = cluster.name;     // IMPORTANT: send cluster NAME
        option.text = cluster.name;
        clusterSelect.appendChild(option);
    });
}

/* =================================
   2. Load warehouses by cluster name
   ================================= */
async function loadWarehouses() {
    const clusterSelect = document.getElementById("clusters");
    const clusterName = clusterSelect.value;

    if (!clusterName) return;

    const response = await fetch(`/api/warehouses?cluster_name=${encodeURIComponent(clusterName)}`);
    const data = await response.json();

    const warehouseSelect = document.getElementById("warehouses");
    warehouseSelect.innerHTML = '<option value="">Points To Ship Supplies</option>';

    if (!data.warehouses) return;

    data.warehouses.forEach(warehouse => {
        const option = document.createElement("option");
        option.value = warehouse.warehouse_id;
        option.text = `${warehouse.name} (${warehouse.type})`;
        warehouseSelect.appendChild(option);
    });
}

/* =========================
   3. Event bindings
   ========================= */
document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("place").addEventListener("change", loadClusters);
    document.getElementById("clusters").addEventListener("change", loadWarehouses);
});
</script>



</body>
</html>
